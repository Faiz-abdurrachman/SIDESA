generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  ADMIN
  RT
  KEPALA_DESA
}

enum JenisKelamin {
  LAKI_LAKI
  PEREMPUAN
}

enum StatusPenduduk {
  AKTIF
  PINDAH
  MENINGGAL
}

enum JenisSurat {
  DOMISILI
  TIDAK_MAMPU
}

enum StatusSurat {
  PENDING
  APPROVED
  REJECTED
}

model User {
  id        String   @id @default(uuid())
  name      String
  email     String   @unique
  password  String
  role      Role
  createdAt DateTime @default(now()) @map("created_at")

  suratCreated Surat[]
  auditLogs    AuditLog[]

  @@map("users")
}

model KartuKeluarga {
  id        String   @id @default(uuid())
  noKk      String   @unique @map("no_kk")
  alamat    String
  rt        String
  rw        String
  createdAt DateTime @default(now()) @map("created_at")

  penduduk Penduduk[]

  @@map("kartu_keluarga")
}

model Penduduk {
  id           String         @id @default(uuid())
  nik          String         @unique
  nama         String
  tanggalLahir DateTime       @map("tanggal_lahir")
  jenisKelamin JenisKelamin   @map("jenis_kelamin")
  pekerjaan    String
  status       StatusPenduduk @default(AKTIF)
  kkId         String         @map("kk_id")
  createdAt    DateTime       @default(now()) @map("created_at")

  kartuKeluarga KartuKeluarga @relation(fields: [kkId], references: [id])
  surat         Surat[]

  @@map("penduduk")
}

model Surat {
  id          String      @id @default(uuid())
  nomorSurat  String      @unique @map("nomor_surat")
  jenis       JenisSurat
  status      StatusSurat @default(PENDING)
  pendudukId  String      @map("penduduk_id")
  createdById String      @map("created_by_id")
  createdAt   DateTime    @default(now()) @map("created_at")

  penduduk  Penduduk @relation(fields: [pendudukId], references: [id])
  createdBy User     @relation(fields: [createdById], references: [id])

  @@map("surat")
}

model AuditLog {
  id        String   @id @default(uuid())
  userId    String   @map("user_id")
  action    String
  tableName String   @map("table_name")
  recordId  String   @map("record_id")
  createdAt DateTime @default(now()) @map("created_at")

  user User @relation(fields: [userId], references: [id])

  @@map("audit_log")
}
