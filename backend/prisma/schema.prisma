generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  ADMIN
  RT
  KEPALA_DESA
}

enum JenisKelamin {
  LAKI_LAKI
  PEREMPUAN
}

enum StatusPenduduk {
  AKTIF
  PINDAH
  MENINGGAL
}

enum JenisSurat {
  DOMISILI
  TIDAK_MAMPU
}

enum StatusSurat {
  PENDING
  APPROVED
  REJECTED
}

enum HubunganKeluarga {
  KEPALA_KELUARGA
  ISTRI
  ANAK
  MENANTU
  CUCU
  ORANG_TUA
  MERTUA
  FAMILI_LAIN
  LAINNYA
}

enum JenisMutasi {
  MASUK
  KELUAR
  LAHIR
  MENINGGAL
}

model User {
  id        String   @id @default(uuid())
  name      String
  email     String   @unique
  password  String
  role      Role
  createdAt DateTime @default(now()) @map("created_at")

  suratCreated    Surat[]
  mutasiCreated   MutasiPenduduk[]
  auditLogs       AuditLog[]

  @@map("users")
}

model Rw {
  id        String    @id @default(uuid())
  nomorRw   String    @unique @map("nomor_rw")
  createdAt DateTime  @default(now()) @map("created_at")
  deletedAt DateTime? @map("deleted_at")

  rt Rt[]

  @@map("rw")
}

model Rt {
  id        String    @id @default(uuid())
  nomorRt   String    @map("nomor_rt")
  rwId      String    @map("rw_id")
  createdAt DateTime  @default(now()) @map("created_at")
  deletedAt DateTime? @map("deleted_at")

  rw Rw @relation(fields: [rwId], references: [id])

  @@unique([nomorRt, rwId])
  @@map("rt")
}

model KartuKeluarga {
  id        String    @id @default(uuid())
  noKk      String    @unique @map("no_kk")
  alamat    String
  rt        String
  rw        String
  createdAt DateTime  @default(now()) @map("created_at")
  deletedAt DateTime? @map("deleted_at")

  penduduk Penduduk[]

  @@map("kartu_keluarga")
}

model Penduduk {
  id           String         @id @default(uuid())
  nik          String         @unique
  nama         String
  tanggalLahir DateTime       @map("tanggal_lahir")
  jenisKelamin JenisKelamin   @map("jenis_kelamin")
  pekerjaan    String
  status             StatusPenduduk   @default(AKTIF)
  hubunganKeluarga   HubunganKeluarga? @map("hubungan_keluarga")
  kkId               String           @map("kk_id")
  createdAt          DateTime         @default(now()) @map("created_at")
  deletedAt          DateTime?        @map("deleted_at")

  kartuKeluarga KartuKeluarga @relation(fields: [kkId], references: [id])
  surat         Surat[]
  mutasi        MutasiPenduduk[]

  @@map("penduduk")
}

model Surat {
  id          String      @id @default(uuid())
  nomorSurat  String      @unique @map("nomor_surat")
  jenis       JenisSurat
  status      StatusSurat @default(PENDING)
  pendudukId  String      @map("penduduk_id")
  createdById String      @map("created_by_id")
  createdAt   DateTime    @default(now()) @map("created_at")

  penduduk  Penduduk @relation(fields: [pendudukId], references: [id])
  createdBy User     @relation(fields: [createdById], references: [id])

  @@map("surat")
}

model MutasiPenduduk {
  id            String       @id @default(uuid())
  pendudukId    String       @map("penduduk_id")
  jenisMutasi   JenisMutasi  @map("jenis_mutasi")
  tanggalMutasi DateTime     @map("tanggal_mutasi")
  keterangan    String?
  createdById   String       @map("created_by_id")
  createdAt     DateTime     @default(now()) @map("created_at")
  deletedAt     DateTime?    @map("deleted_at")

  penduduk  Penduduk @relation(fields: [pendudukId], references: [id])
  createdBy User     @relation(fields: [createdById], references: [id])

  @@map("mutasi_penduduk")
}

model AuditLog {
  id        String   @id @default(uuid())
  userId    String   @map("user_id")
  action    String
  tableName String   @map("table_name")
  recordId  String   @map("record_id")
  createdAt DateTime @default(now()) @map("created_at")

  user User @relation(fields: [userId], references: [id])

  @@map("audit_log")
}
